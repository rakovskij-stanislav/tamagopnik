# tamagopnik

**Привет!** Этот документ является публичным документом игры “Тамагопник”, проекта за авторством Раковского Станислава. Сюжет игры является общественным достоянием пользователей Интернета и может быть использован в любых целях, за исключением коммерческих.

Игра, сценарий которой творит общество!
Канал в Telegram - https://web.telegram.org/#/im?p=@tamagopnik - там будут проходить голосования за сценарии.

Здесь описывается формирование сценария для игры в вид, который будет понятен движку. Используемый язык - python (в нем нет точек с запятой для разделения текста, текст разделяется табуляцией)

 * Движок
  * [Файлы проекта](#project-files)
  * [Сценарий глазами движка. Типичный вид румы](#room)
  * [Функции квестов](#fun-quest)
  * [Пример двух связанный рум](#two-fated-rooms)
  * [Комментирование](#comm)
 * Участие в жизни проекта
  * [Творческая сторона](#crea-side)
  * [Перевод сырого текста в нужный движку вид](#text-adapt)
  * ["Что мне за это будет?"](#i-want-something-from-you)
  * [Как часто выходят обновления движка и сценария?](#updates)
  * [Техническая сторона](#tech-side)
 * [Известные ~~фичи~~ баги движка](#bugs)
 * [Об авторе](#about)
 * [Поддержка проекта](#support)

# Движок
## <a name="project-files"></a> Файлы проекта.
- application.py - главный файл программы. Содержит в себе движок.
- db.py - содержит в себе классы для баз данных, которые пока просто являются обертками для массивов. В будущем планируется выбрать, к примеру, sqlite или MySql и хранить в этом модуле обертку для них (благо, основы sql баз данных будут во втором семестре).
- extra.py - хранит текст игры в виде, который воспринимает движок. Некоторые реплики в этом файле и в оригинальном тексте могут различаться, это связано с оптимизацией по длине текста, чтобы текст был виден. Если Вы считаете, что где-то есть грубое отступление от текста, надо об этом сказать.
- Сценарии - папка сценариев. Сюда складываются предложенные работы.
- config.py - файл, в котором храню пароль от бота. Вынесен в отдельный файл в целях безопасности. В репозитории невидим.
- README.MD - этот файл, объясняющий всё и вся.

## <a name="room"></a> Типичный вид румы:

````python
class FirstRoom(room):
    quest = ["Привет, хехе",
             "Make a wish and become a mohou shoujo",
             ["choose", {"Okay, Kubei, make me a mahou shoujo": "quest1",
                         "No, Inkubeta!":"quest1"}]
             ]
    quest1 = ["Вы почуствовали невероятный прилив сил",
              ['end', 'Вжух! Вы умерли, для старта сначала нажмите /start']
              ]
````
    
Класс представляет собой саму комнату. Квесты, переменные комнаты, являются листами, которые хранят в себе либо обычную строку, либо еще один некий лист.
Обычный текст выводится игроку. Листы внутри квестов являются функциями квестов (в примере можно увидеть `choose` и `end`).

## <a name="fun-quest"></a> Функции квестов:
Текущие функции, которые может обрабатывать движок:

1. ['end', 'text'] - Окончание игры. Выводит text, стирает данные об игроке из базы. Будьте осторожны с его использованием. Я не думаю, что большинство игроков будут играть на хардкоре, всё-таки потерять все данные в середине игры - удовольствие не из приятных
2. ['goto', 'X', 'Y']- перемещает в комнату X, квест Y
3. ['сhoose', {"text1": "quest1",..., "textN":"questN"}] - предлагает игроку выбрать один из предложенных ответов. В зависимости от ответа, его переносит в определенный квест, принадлежащий текущей комнате.
4. ['take', 'X' (,'Y')]- вещь X поднимается и заносится в инвентарь игрока. Игрок не имеет возможности смотреть содержимое инвентаря, так что можно хранить в нем флаги выполнения определенных условий (например, поговорить с Паханом можно только при условии, что ты получишь "Согласие от Саши" и "Красная кепка"). Текст Y произносится, если он определен.
5. ['drop', 'X' (,'Y')] - вещь изымается из инвентаря. Если ее нет в инвентаре, игроку показывается оповещение, которое он должен показать автору, это оповещение не дает данному игроку продолжить игру.
6. ['item_exist', 'item_name', 'quest1', 'quest2'] - если вещь есть в инвентаре, то переход на квест1, иначе - квест2
7. ['random', 'A', 'B', 'C', ..., 'Z'] - случайно выбирает один из перечисленых вариантов диалог-массивов и переходит к нему.
8. ['compile', 'some text, {one}, {two}, sometext', 'params'] - печатает форматированный текст.

                          На самом деле, оно делает вот что : ans = eval('"'+text+'".format('+params+')')
                          То есть используется функция format для строк, чтобы форматировать текст.
                          
                          Что можно с этим делать :
                          - с помощью random  шаманить с текстами. Пример :
                              ['compile', "В лесу родилась {name}, {nya}", 'name=["Ёлочка", "Собачка"].random.randrange(2)', nya = "meow"' ]
                          - показывать какую-нибудь техническую информацию, связанную с телеграммом. Например, id текущего игрока (bot.chat.id)
                          - соединять слова. Например, name="Елочка"+str(str(random.randrange(3000,4000)))
                          
                          
## <a name="two-fated-rooms"></a> Так выглядят две связаные комнаты, представляющие собой законченный и неизбежный квест :
````python
class teststartroom(room):
    quest = ["Привет, хехе",
             "Make a wish and become a mohou shoujo",
             ["choose", {"Okay, Kubei, make me a mahou shoujo": "quest1",
                         "No, Inkubeta!":"quest1"}]
             ]
    quest1 = ["Вы почуствовали невероятный прилив сил",
              ["goto", "endo", "quest"]]
    quest2 = [[""]]

class endo(room):
    quest = ["Силы до сих пор наполняют тебя",
             ["take", "серебряная ложка", "Вы подняли серебряную ложку"],
             ["compile", "Это оказалась серебряная ложка {}", "'изменника'"],
             ["random", "quest1", "quest2"]]
    quest1 = ["magic fairy",
              ['end', "Удача убила тебя!"]]
    quest2 = ["maggle, no magic for you!",
              ["end", "Умер как обычный человек!"]]
````

## <a name="comm"></a> Комментирование:
````python
class teststartroom(room):
    quest = ["Привет, хехе", #комментарий 1
             "Make a wish and become a mohou shoujo",
             '''
             Мне кажется, или этот бело-фиолетовый кот что-то замышляет
             Но я всего лишь комментарий, поэтому ничего не могу поделать
             '''
             ["choose", {"Okay, Kubei, make me a mahou shoujo": "quest1",
                         "No, Inkubeta!":"quest1"}]
             ]
    quest1 = ["Вы почуствовали невероятный прилив сил",
              ["goto", "endo", "quest"]]
    quest2 = [[""]]
````


# Участие в жизни проекта

## <a name="crea-side"></a> Творческая сторона

###### Немного о тексте.
1. Не допускаются мат, чернуха. Да, жизнь нелегка, но использование мата может повлечь определенные проблемы.
2. Не стоит религиозные издевательские темы поднимать. У меня (в России) законы о защите чувств верующих суровы, любой чих в сторону тех, кого опекает сам Бог, будет караться судом, штрафами и тюрьмой.
3. Можно использовать актуальные события (пример : террор МГУ и палисадников на внедорожниках в конце 2016 - начале 2017), но с расчетом на то, что через пару лет информация может потерять значимость.

###### У меня есть сценарий для игры? Как мне быть?
Присылайте на почту - rakovskij.stanislav@gmail.com.
Если есть гитхаб - каким-нибудь образом дайте мне знать.
Можно прислать файл и через telegram.
Они будут выкладываться в папке "Сценарии", затем на канале telegram @tamagopnik будет запускаться опрос о включении этого сценария о общее повествование
Можно расшарить файл на дропбоксе/яд/гуглдоках/(свой вариант)

#### <a name="text-adapt"></a> А я могу привести его в вид, нужный движку!
О! Отлично. Я постарался сделать движок не очень запутанным (кроме функции compile, хех), так что надеюсь на твою поддержку).
За примерами оформления далеко ходить не надо - файл extra.py и текст наверху введут в курс дела.

## <a name="i-want-something-from-you"></a> "Что мне за это будет?"
Каждый человек, внесший весомый вклад, достоин награды. В файле thanks.txt будет отображаться твои имя-фамилия/ник/что-то_еще/(нужное подчеркнуть), и краткий вклад ("придумал сюжет с гопниками в Питере", "дал совет по оптимизации движка", "бесстрашный хостер", "яростно сражался с опечатками", etc)

## <a name="updates"></a> Как часто выходят обновления движка и сценария?
Минимум раз в неделю (скорее всего - почти каждый день) будут просматриваться новые сообщения, заливаться тексты в репозиторий, запускаться голосования. Следите за обновлениями

## <a name="tech-side"></a> Техническая сторона
**Q** : Я большая компания и я хочу хостить проект!

**A** : Отлично! Свяжитесь со мной, обсудим вопрос.

<br>

**Q** : Можно взять исходники движка, написать свой квест с Франкенштейном и мумиями и ~вжух~ - в продакшн?

**A** : Допускается использовать движок и сценарий в любых целях, даже в коммерческих. Но не рекомендую делать последнее, расстроюсь ~~за недополученную прибыль, начну судиться~~.


## <a name="bugs"></a> Баги движка

 1. Не совсем баг, но и не фича :

    Так как choose реагирует на последнее введенное игроком слово, нужно быть аккуратным, чтобы ранее введенное слово не было триггером для действия следующего choose, которое по факту игрок не совершил. Это явно наблюдается в предыстории - там я использую различные знаки препинания после "Дальше", чтобы сразу не пропустить всю предысторию. Схожая беда есть в выборе машин в третьей главе : если мы отказались от Москвича, а в рандомной карусели попадается снова он, то надо либо исключить сам факт повторного попадания в этот раз опять к Москвичу, либо заставить персонажа сказать какую-нибудь фразу перед выбором ответа.


 2. Юридическая сторона вопроса.

    Хоть я и написал, что труд является общественным, но я еще не разобрался, под какой лицензией отправляться в открытое плавание. Жду экспертного мнения.



## <a name="about"></a> Об авторе
**Еще раз привет!** Меня зовут Раковский Станислав, я студент-первокурсник одного из технических вузов Москвы. Интересуюсь многопользовательскими приложениями, умею ремонтировать компьютеры и телефоны, с детства дружу с техникой. Пишу на Python с 9 класса, умею в Tk/Bottle. Пользователь ubuntu.


###### Зачем я это делаю?

1. Интересно. Какому джуниору не хочется поиграться?
2. Знакомство с новыми технологиями. Вот представьте, опубликовали код, а через пару дней стучится человек, говорит о том, что вызовы time.time() для сравнения онлайна неэффективны, что тут можно сделать %тут описана какая-то странная полулегальная функция, которая забирает время напрямую с тактового генератора процессора с минимальными задержками, написанная на фасме%
3. Открытый код - путь к совершенствованию. Ожидаю советов по оптимизации движка.
4. Новые люди. Вдруг познакомлюсь с человеком, который может достать с подпольного рынка задешево целый кластер серверов на lga771 :Р
5. Проект как резюме. Будет что представить работодателю, можно сделать его проектом для 4 курса.

### <a name="support"></a> Поддержка проекта.
По правде говоря, я был бы совсем не против, если Вы поддержите проект.

1. Если Вы как-нибудь связаны с IT (например, содержите питонистов), то я с радостью присоединюсь в качестве стажера. Если научите чему-нибудь новому, например, фреймворкам Flack|Django или работе с большими данными, то будет просто волшебно. Живу в Москве, территориально Парк Культуры.
2. Если можете предложить площадку, на которой можно без опасений хостить игру, то я с радостью на это посмотрю.
